{"version":3,"file":"js/addon-entry-terminal.js","sources":["webpack://GUI/./src/addons/addons/Terminal/terminal.css","webpack://GUI/./src/addons/addons/Terminal/_runtime_entry.js","webpack://GUI/./src/addons/addons/Terminal/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* Terminal 按钮样式 - 与 Scratch 菜单栏按钮风格一致 */\\n.sa-terminal-button {\\n  font-family: \\\"Helvetica Neue\\\", Helvetica, Arial, sans-serif;\\n  font-size: 0.7rem;\\n  font-weight: bold;\\n  padding: 0 10px;\\n  height: 32px;\\n  background: transparent;\\n  color: white;\\n  border: none;\\n  border-radius: 12px;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  white-space: nowrap;\\n}\\n\\n.sa-terminal-button:hover {\\n  background: rgba(255, 255, 255, 0.1);\\n}\\n\\n.sa-terminal-button:active {\\n  background: rgba(255, 255, 255, 0.2);\\n}\", \"\"]);\n\n// exports\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./terminal.css\";\nexport default {\n  \"userscript.js\": _js,\n  \"terminal.css\": _css\n};","export default async function ({ addon, console }) {\n  // 等待 DOM 加载完成\n  await addon.tab.waitForElement(\"body\", { markAsSeen: true });\n\n  // 存储弹窗引用\n  let terminalWindow = null;\n\n  // 打开终端弹窗\n  const openTerminalWindow = () => {\n    if (terminalWindow && !terminalWindow.closed) {\n      terminalWindow.focus();\n      return;\n    }\n\n    // 创建弹窗窗口\n    const width = 800;\n    const height = 500;\n    const left = (window.screen.width - width) / 2;\n    const top = (window.screen.height - height) / 2;\n\n    terminalWindow = window.open(\n      \"\",\n      \"scratch_terminal\",\n      `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`\n    );\n\n    if (!terminalWindow) {\n      alert(\"无法打开终端窗口。请允许弹出窗口。\");\n      return;\n    }\n\n    // 设置弹窗内容\n    terminalWindow.document.title = \"Scratch Terminal\";\n    terminalWindow.document.body.style.margin = \"0\";\n    terminalWindow.document.body.style.padding = \"0\";\n    terminalWindow.document.body.style.background = \"#1e1e1e\";\n    terminalWindow.document.body.style.overflow = \"hidden\";\n\n    // 创建终端容器\n    const terminalContainer = terminalWindow.document.createElement(\"div\");\n    terminalContainer.style.cssText = \"width: 100%; height: 100%; padding: 10px; box-sizing: border-box;\";\n    terminalWindow.document.body.appendChild(terminalContainer);\n\n    // 加载 xterm.js 库\n    const loadLibraries = async () => {\n      return Promise.all([\n        new Promise((resolve, reject) => {\n          const script = terminalWindow.document.createElement(\"script\");\n          script.src = \"https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js\";\n          script.onload = resolve;\n          script.onerror = reject;\n          terminalWindow.document.head.appendChild(script);\n        }),\n        new Promise((resolve, reject) => {\n          const link = terminalWindow.document.createElement(\"link\");\n          link.rel = \"stylesheet\";\n          link.href = \"https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css\";\n          link.onload = resolve;\n          link.onerror = reject;\n          terminalWindow.document.head.appendChild(link);\n        })\n      ]);\n    };\n\n    // 初始化终端\n    const initTerminal = async () => {\n      await loadLibraries();\n\n      const Terminal = terminalWindow.Terminal;\n      const term = new Terminal({\n        theme: {\n          background: \"#1e1e1e\",\n          foreground: \"#d4d4d4\",\n          cursor: \"#4d97ff\",\n          cursorAccent: \"#1e1e1e\",\n          selection: \"rgba(77, 151, 255, 0.3)\",\n          black: \"#1e1e1e\",\n          red: \"#cd3131\",\n          green: \"#0dbc79\",\n          yellow: \"#e5e510\",\n          blue: \"#2472c8\",\n          magenta: \"#bc3fbc\",\n          cyan: \"#11a8cd\",\n          white: \"#e5e5e5\",\n          brightBlack: \"#666666\",\n          brightRed: \"#f14c4c\",\n          brightGreen: \"#23d18b\",\n          brightYellow: \"#f5f543\",\n          brightBlue: \"#3b8eea\",\n          brightMagenta: \"#d670d6\",\n          brightCyan: \"#29b8db\",\n          brightWhite: \"#ffffff\"\n        },\n        fontFamily: '\"Courier New\", Courier, monospace',\n        fontSize: 14,\n        lineHeight: 1.2,\n        cursorBlink: true,\n        cursorStyle: \"block\"\n      });\n\n      term.open(terminalContainer);\n\n      // 欢迎消息\n      term.writeln(\"\\x1b[1;34m=== Scratch Terminal ===\\x1b[0m\");\n      term.writeln(\"\\x1b[32mTerminal ready.\\x1b[0m\");\n      term.writeln(\"Type commands and press Enter to execute.\");\n      term.writeln(\"\");\n\n      // 监听终端输入\n      let currentLine = \"\";\n      term.write(\"\\x1b[32m$\\x1b[0m \");\n\n      term.onData((data) => {\n        switch (data) {\n          case \"\\r\": // Enter\n            term.writeln(\"\");\n            if (currentLine.trim()) {\n              const args = currentLine.trim().split(/\\s+/);\n              const cmd = args[0].toLowerCase();\n\n              switch (cmd) {\n                case \"clear\":\n                case \"cls\":\n                  term.clear();\n                  break;\n                case \"help\":\n                  term.writeln(\"Available commands:\");\n                  term.writeln(\"  clear, cls - Clear the terminal\");\n                  term.writeln(\"  help       - Show this help message\");\n                  term.writeln(\"  echo       - Echo the input text\");\n                  term.writeln(\"  date       - Show current date and time\");\n                  break;\n                case \"echo\":\n                  term.writeln(args.slice(1).join(\" \"));\n                  break;\n                case \"date\":\n                  term.writeln(new Date().toString());\n                  break;\n                default:\n                  term.writeln(`\\x1b[31mCommand not found: ${cmd}\\x1b[0m`);\n                  term.writeln(\"Type 'help' for available commands.\");\n              }\n            }\n            currentLine = \"\";\n            term.write(\"\\x1b[32m$\\x1b[0m \");\n            break;\n          case \"\\u007F\": // Backspace\n            if (currentLine.length > 0) {\n              currentLine = currentLine.slice(0, -1);\n              term.write(\"\\b \\b\");\n            }\n            break;\n          default:\n            if (data.charCodeAt(0) >= 32) {\n              currentLine += data;\n              term.write(data);\n            }\n        }\n      });\n\n      // 监听窗口大小变化\n      terminalWindow.addEventListener(\"resize\", () => {\n        terminalContainer.style.width = \"100%\";\n        terminalContainer.style.height = \"100%\";\n      });\n    };\n\n    initTerminal();\n\n    // 监听窗口关闭事件\n    terminalWindow.addEventListener(\"beforeunload\", () => {\n      terminalWindow = null;\n    });\n  };\n\n  // 创建打开终端按钮 - 放在 SPA 分析器按钮旁边\n  const terminalButton = document.createElement(\"button\");\n  terminalButton.className = addon.tab.scratchClass('menu-bar_menu-bar-button', {\n    others: 'sa-terminal-button'\n  });\n  terminalButton.textContent = \"Terminal\";\n  terminalButton.title = \"打开终端窗口\";\n  terminalButton.addEventListener(\"click\", openTerminalWindow);\n\n  addon.tab.displayNoneWhileDisabled(terminalButton);\n\n  // 等待标签栏加载完成\n  await addon.tab.waitForElement('[class*=\"react-tabs_react-tabs__tab-list\"]', {\n    markAsSeen: true,\n    reduxEvents: [\n      \"scratch-gui/mode/SET_PLAYER\",\n      \"fontsLoaded/SET_FONTS_LOADED\",\n      \"scratch-gui/locales/SELECT_LOCALE\"\n    ],\n  });\n\n  // 查找 SPA 分析器按钮\n  const findAnalyzeButton = () => {\n    return document.querySelector('.sa-analyze-button');\n  };\n\n  // 插入终端按钮\n  const insertTerminalButton = () => {\n    const analyzeButton = findAnalyzeButton();\n    if (analyzeButton && !terminalButton.parentNode) {\n      analyzeButton.parentNode.insertBefore(terminalButton, analyzeButton.nextSibling);\n      return true;\n    }\n    // 如果没有找到分析器按钮，插入到标签栏\n    const tabBar = document.querySelector('[class*=\"react-tabs_react-tabs__tab-list\"]');\n    if (tabBar && !terminalButton.parentNode) {\n      tabBar.appendChild(terminalButton);\n      return true;\n    }\n    return false;\n  };\n\n  // 尝试插入按钮，如果失败则重试\n  if (!insertTerminalButton()) {\n    const observer = new MutationObserver(() => {\n      if (insertTerminalButton()) {\n        observer.disconnect();\n      }\n    });\n    observer.observe(document.body, { childList: true, subtree: true });\n  }\n}"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;;;;A","sourceRoot":""}