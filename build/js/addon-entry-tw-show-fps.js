(window["webpackJsonpGUI"] = window["webpackJsonpGUI"] || []).push([["addon-entry-tw-show-fps"],{

/***/ "./node_modules/css-loader/index.js!./src/addons/addons/show-fps/style.css":
/*!************************************************************************!*\
  !*** ./node_modules/css-loader!./src/addons/addons/show-fps/style.css ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(/*! ../../../../node_modules/css-loader/lib/css-base.js */ "./node_modules/css-loader/lib/css-base.js")(false);
// imports


// module
exports.push([module.i, ".fps-container-container {\n  display: flex;\n  align-items: center;\n  padding: 0.25rem;\n  -webkit-user-select: none;\n  user-select: none;\n  width: 60px;\n  justify-content: center;\n  position: relative;\n}\n\n.fps-container {\n  font-size: 0.6rem;\n  font-weight: bold;\n  font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n  color: #82c1ff;\n  white-space: nowrap;\n}\n\n/* Use pseudo elements to avoid firing mutation observers by just moving the cursor */\n.fps-container > span::after {\n  content: attr(data-content);\n}\n\n.sa-small-stage .fps-container-container {\n  display: none !important;\n}", ""]);

// exports


/***/ }),

/***/ "./src/addons/addons/show-fps/_runtime_entry.js":
/*!******************************************************!*\
  !*** ./src/addons/addons/show-fps/_runtime_entry.js ***!
  \******************************************************/
/*! exports provided: resources */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "resources", function() { return resources; });
/* harmony import */ var _userscript_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userscript.js */ "./src/addons/addons/show-fps/userscript.js");
/* harmony import */ var _css_loader_style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! css-loader!./style.css */ "./node_modules/css-loader/index.js!./src/addons/addons/show-fps/style.css");
/* harmony import */ var _css_loader_style_css__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_css_loader_style_css__WEBPACK_IMPORTED_MODULE_1__);
/* generated by pull.js */


const resources = {
  "userscript.js": _userscript_js__WEBPACK_IMPORTED_MODULE_0__["default"],
  "style.css": _css_loader_style_css__WEBPACK_IMPORTED_MODULE_1___default.a
};

/***/ }),

/***/ "./src/addons/addons/show-fps/userscript.js":
/*!**************************************************!*\
  !*** ./src/addons/addons/show-fps/userscript.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _libraries_common_cs_small_stage_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../libraries/common/cs/small-stage.js */ "./src/addons/libraries/common/cs/small-stage.js");

/* harmony default export */ __webpack_exports__["default"] = (async function (_ref) {
  let {
    addon,
    console
  } = _ref;
  // 创建 FPS 显示容器
  const fpsContainerContainer = document.createElement("div");
  addon.tab.displayNoneWhileDisabled(fpsContainerContainer, {
    display: "flex"
  });
  const fpsContainer = document.createElement("div");
  const fpsText = document.createElement("span");
  fpsContainerContainer.className = "fps-container-container";
  fpsContainer.className = "fps-container";
  fpsContainerContainer.appendChild(fpsContainer);
  fpsContainer.appendChild(fpsText);
  const vm = addon.tab.traps.vm;

  // FPS 计算逻辑 - 参考 debugger/performance.js
  const renderTimes = [];
  let lastFpsTime = performance.now();
  let currentFps = 60;
  let updateInterval = null;
  const updateFps = () => {
    if (addon.self.disabled) return;
    const now = performance.now();

    // 移除超过 1 秒的帧时间记录
    while (renderTimes.length > 0 && renderTimes[0] <= now - 1000) {
      renderTimes.shift();
    }
    renderTimes.push(now);

    // 每秒更新一次显示
    if (now - lastFpsTime >= 1000) {
      lastFpsTime = now;

      // 获取目标帧率
      const maxFps = vm.runtime.frameLoop.framerate === 0 ? 60 : vm.runtime.frameLoop.framerate;
      currentFps = Math.min(renderTimes.length, maxFps);
      fpsText.style.color = currentFps > maxFps * 0.7 ? "#82c1ff" : currentFps > maxFps * 0.5 ? "#82ff97" : currentFps > maxFps * 0.2 ? "rgb(255, 197, 130)" : "rgb(255, 130, 130)";
      fpsText.setAttribute("data-content", "".concat(currentFps, " FPS"));
    }
  };

  // 使用 addAfterStepCallback 在每次 VM step 后更新 FPS
  const originalStep = vm.runtime._step;
  vm.runtime._step = function () {
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }
    const ret = originalStep.call(this, ...args);
    updateFps();
    return ret;
  };

  // 初始化显示
  fpsText.setAttribute("data-content", "60 FPS");
  Object(_libraries_common_cs_small_stage_js__WEBPACK_IMPORTED_MODULE_0__["default"])();
  while (true) {
    await addon.tab.waitForElement('[class*="controls_controls-container"]', {
      markAsSeen: true,
      reduxEvents: ["scratch-gui/mode/SET_PLAYER", "fontsLoaded/SET_FONTS_LOADED", "scratch-gui/locales/SELECT_LOCALE"]
    });
    if (addon.tab.editorMode === "editor") {
      addon.tab.appendToSharedSpace({
        space: "afterStopButton",
        element: fpsContainerContainer,
        order: 0
      });
    } else {
      fpsContainerContainer.remove();
    }
  }
});

/***/ }),

/***/ "./src/addons/libraries/common/cs/small-stage.js":
/*!*******************************************************!*\
  !*** ./src/addons/libraries/common/cs/small-stage.js ***!
  \*******************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return addSmallStageClass; });
function addSmallStageClass() {
  // TW: no-op; sa-small-stage class is handled by scratch-gui
}

/***/ })

}]);
//# sourceMappingURL=addon-entry-tw-show-fps.js.map