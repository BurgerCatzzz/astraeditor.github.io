{"version":3,"file":"js/addon-entry-simple-project-analyzer.js","sources":["webpack://GUI/./src/addons/addons/simple-project-analyzer/userstyle.css","webpack://GUI/./src/addons/addons/simple-project-analyzer/_runtime_entry.js","webpack://GUI/./src/addons/addons/simple-project-analyzer/userscript.js","webpack://GUI/./src/addons/addons/simple-project-analyzer/SPA.svg"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/* 分析按钮样式 */\\n.sa-analyze-button {\\n  display: flex;\\n  justify-items: center;\\n  align-items: center;\\n  margin-top: auto !important;\\n  margin-bottom: auto !important;\\n  font-family: inherit;\\n  font-size: 12px;\\n  font-weight: bold;\\n  background-color: var(--ui-white);\\n  border-width: 1px;\\n  border-style: solid;\\n  color: var(--text-primary);\\n  border-color: var(--ui-black-transparent);\\n  padding: 0.2rem 0.5rem;\\n  margin: 0;\\n  border-radius: 4px;\\n  cursor: pointer;\\n  transition: border-color 0.2s ease;\\n  margin-left: 10px;\\n  white-space: nowrap;\\n  width: auto;\\n  height: 1.5rem;\\n}\\n\\n.sa-analyze-button:hover {\\n  border-color: var(--motion-primary);\\n}\\n\\n/* VSCode 布局下的分析按钮样式 */\\n[class*=\\\"tabs\\\"][class*=\\\"vscodeList\\\"] .sa-analyze-button {\\n  width: 40px;\\n  height: 30px;\\n  font-size: 0;\\n  background-color: #00000000;\\n  border: 0;\\n  border-radius: 0 !important;\\n  margin: 0 !important;\\n  padding: 0 !important;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n  position: relative;\\n  margin-bottom: 10px !important;\\n\\n}\\n\\n[class*=\\\"tabs\\\"][class*=\\\"vscodeList\\\"] .sa-analyze-button img {\\n  width: 2rem;\\n  height: 2rem;\\n}\\n\\n/* 模态框样式 */\\n.sa-analyze-modal-popup {\\n  max-width: 90%;\\n  max-height: 90vh;\\n  width: 900px;\\n  height: 80vh;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.sa-analyze-modal-popup [class*=\\\"modal_header\\\"] {\\n  padding: 16px;\\n  flex-shrink: 0;\\n  display: flex;\\n  align-items: center;\\n  border-bottom: 1px solid rgba(0, 0, 0, 0.1);\\n}\\n\\n.sa-analyze-modal-popup [class*=\\\"modal_header-item-title\\\"] {\\n  font-size: 18px;\\n  font-weight: 600;\\n}\\n\\n.sa-analyze-modal-content {\\n  padding: 0;\\n  overflow: hidden;\\n  flex-grow: 1;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.sa-analyze-loading {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  justify-content: center;\\n  padding: 60px;\\n  height: 100%;\\n}\\n\\n.sa-analyze-spinner {\\n  width: 50px;\\n  height: 50px;\\n  border: 4px solid rgba(0, 0, 0, 0.1);\\n  border-radius: 50%;\\n  border-top-color: var(--ui-primary);\\n  animation: sa-analyze-spin 1s ease-in-out infinite;\\n  margin-bottom: 20px;\\n}\\n\\n@keyframes sa-analyze-spin {\\n  to { transform: rotate(360deg); }\\n}\\n\\n.sa-analyze-results {\\n  height: 100%;\\n  overflow-y: auto;\\n  padding: 20px;\\n}\\n\\n/* 模态框主体样式 */\\n.sa-analyze-modal-body {\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 24px;\\n}\\n\\n/* 节样式 */\\n.sa-analyze-section {\\n  background: var(--ui-secondary);\\n  border-radius: 12px;\\n  padding: 20px;\\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\\n}\\n\\n.sa-analyze-section-title {\\n  font-size: 18px;\\n  font-weight: 600;\\n  color: var(--text-primary);\\n  margin: 0 0 16px 0;\\n  padding-bottom: 8px;\\n  border-bottom: 1px solid rgba(0, 0, 0, 0.1);\\n}\\n\\n/* 统计网格样式 */\\n.sa-analyze-stats-grid {\\n  display: grid;\\n  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\\n  gap: 16px;\\n}\\n\\n.sa-analyze-stat {\\n  background: var(--ui-white);\\n  border-radius: 8px;\\n  padding: 16px;\\n  text-align: center;\\n  transition: transform 0.2s, box-shadow 0.2s;\\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);\\n}\\n\\n.sa-analyze-stat:hover {\\n  transform: translateY(-2px);\\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\\n}\\n\\n.sa-analyze-stat-value {\\n  font-size: 24px;\\n  font-weight: bold;\\n  color: var(--motion-primary);\\n  margin-bottom: 8px;\\n}\\n\\n.sa-analyze-stat-label {\\n  font-size: 14px;\\n  color: var(--text-primary);\\n  opacity: 0.8;\\n}\\n\\n/* 行和列样式 */\\n.sa-analyze-row {\\n  display: flex;\\n  gap: 20px;\\n}\\n\\n.sa-analyze-col-6 {\\n  flex: 1;\\n}\\n\\n/* 图表容器样式 */\\n.sa-analyze-chart-container {\\n  background: var(--ui-white);\\n  border-radius: 8px;\\n  padding: 16px;\\n  height: 300px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);\\n}\\n\\n/* 评分详情样式 */\\n.sa-analyze-score-details {\\n  background: var(--ui-white);\\n  border-radius: 8px;\\n  padding: 16px;\\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);\\n}\\n\\n.sa-analyze-score-summary {\\n  margin-bottom: 16px;\\n  padding-bottom: 12px;\\n  border-bottom: 1px solid rgba(0, 0, 0, 0.1);\\n}\\n\\n.sa-analyze-score-summary h4 {\\n  margin: 0 0 8px 0;\\n  font-size: 16px;\\n  font-weight: 600;\\n  color: var(--text-primary);\\n}\\n\\n.sa-analyze-score-level {\\n  font-size: 14px;\\n  color: var(--text-primary);\\n  opacity: 0.8;\\n}\\n\\n.sa-analyze-score-item {\\n  display: flex;\\n  align-items: center;\\n  margin-bottom: 12px;\\n  gap: 12px;\\n}\\n\\n.sa-analyze-score-label {\\n  flex: 1;\\n  font-size: 14px;\\n  color: var(--text-primary);\\n}\\n\\n.sa-analyze-score-bar {\\n  flex: 2;\\n  height: 8px;\\n  background: rgba(0, 0, 0, 0.1);\\n  border-radius: 4px;\\n  overflow: hidden;\\n}\\n\\n.sa-analyze-score-fill {\\n  height: 100%;\\n  background: var(--motion-primary);\\n  transition: width 0.3s ease;\\n}\\n\\n.sa-analyze-score-value {\\n  width: 40px;\\n  text-align: right;\\n  font-size: 14px;\\n  font-weight: 600;\\n  color: var(--text-primary);\\n}\\n\\n/* 扩展列表样式 */\\n.sa-analyze-extensions-grid {\\n  display: grid;\\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\\n  gap: 16px;\\n}\\n\\n.sa-analyze-extension-item {\\n  background: var(--ui-white);\\n  border-radius: 8px;\\n  padding: 16px;\\n  display: flex;\\n  align-items: center;\\n  gap: 12px;\\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);\\n  transition: transform 0.2s, box-shadow 0.2s;\\n}\\n\\n.sa-analyze-extension-item:hover {\\n  transform: translateY(-2px);\\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\\n}\\n\\n.sa-analyze-extension-color {\\n  width: 16px;\\n  height: 16px;\\n  border-radius: 50%;\\n  flex-shrink: 0;\\n}\\n\\n.sa-analyze-extension-name {\\n  flex: 1;\\n  font-size: 14px;\\n  font-weight: 500;\\n  color: var(--text-primary);\\n}\\n\\n.sa-analyze-extension-count {\\n  font-size: 12px;\\n  color: var(--text-primary);\\n  opacity: 0.7;\\n}\\n\\n/* 滚动条样式 */\\n.sa-analyze-results::-webkit-scrollbar {\\n  width: 8px;\\n}\\n\\n.sa-analyze-results::-webkit-scrollbar-track {\\n  background: rgba(0, 0, 0, 0.05);\\n  border-radius: 4px;\\n}\\n\\n.sa-analyze-results::-webkit-scrollbar-thumb {\\n  background: rgba(0, 0, 0, 0.2);\\n  border-radius: 4px;\\n}\\n\\n.sa-analyze-results::-webkit-scrollbar-thumb:hover {\\n  background: rgba(0, 0, 0, 0.3);\\n}\\n\\n/* 响应式设计 */\\n@media (max-width: 768px) {\\n  .sa-analyze-modal-popup {\\n    max-width: 95%;\\n    max-height: 95vh;\\n    width: auto;\\n    height: auto;\\n  }\\n  \\n  .sa-analyze-stats-grid {\\n    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\\n    gap: 12px;\\n  }\\n  \\n  .sa-analyze-stat {\\n    padding: 12px;\\n  }\\n  \\n  .sa-analyze-stat-value {\\n    font-size: 20px;\\n  }\\n  \\n  .sa-analyze-row {\\n    flex-direction: column;\\n    gap: 16px;\\n  }\\n  \\n  .sa-analyze-chart-container {\\n    height: 250px;\\n  }\\n  \\n  .sa-analyze-extensions-grid {\\n    grid-template-columns: 1fr;\\n  }\\n  \\n  .sa-analyze-button {\\n    font-size: 12px;\\n    padding: 0 8px;\\n  }\\n}\\n\\n@media (max-width: 480px) {\\n  .sa-analyze-section {\\n    padding: 16px;\\n  }\\n  \\n  .sa-analyze-results {\\n    padding: 16px;\\n  }\\n  \\n  .sa-analyze-stats-grid {\\n    grid-template-columns: repeat(2, 1fr);\\n  }\\n}\", \"\"]);\n\n// exports\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userstyle.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userstyle.css\": _css,\n};","// 加载Chart.js库\nasync function loadChartJS() {\n  return new Promise((resolve, reject) => {\n    if (window.Chart) {\n      resolve();\n      return;\n    }\n    \n    const script = document.createElement('script');\n    script.src = 'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js';\n    script.onload = resolve;\n    script.onerror = reject;\n    document.head.appendChild(script);\n  });\n}\nimport icon from '!../../../lib/tw-recolor/build!./SPA.svg'\nexport default async function ({ addon, msg, safeMsg, console }) {\n  // 加载Chart.js库\n  await loadChartJS();\n  \n  // 项目分析器类\n  class SimpleProjectAnalyzer {\n    constructor() {\n      this.analyzeButton = null;\n      this.analyzeModal = null;\n      this.removeModal = null;\n      this.chartInstance = null;\n      this.mathLogicChartInstance = null;\n      this.drScratchChartInstance = null;\n    }\n\n    // 创建分析按钮\n    async createAnalyzeButton() {\n      const VSCodeLayout = JSON.parse(localStorage.getItem('AESettings')).EnableVSCodeLayout;\n\n      // 检测是否在 VSCodeLayout 下\n      const tabBar = await addon.tab.waitForElement('[class*=\"react-tabs_react-tabs__tab-list\"]', {\n        markAsSeen: true\n      });\n\n      // 尝试查找 find-bar 插件的位置\n      const findBar = document.querySelector('.react-tabs');\n      let targetElement;\n\n      if (findBar) {\n        // 如果 find-bar 存在，在其右边添加按钮\n        targetElement = findBar.parentElement;\n      } else {\n        // 否则，使用标签栏\n        targetElement = tabBar;\n      }\n\n      if (!targetElement) return;\n\n      this.analyzeButton = document.createElement('button');\n      this.analyzeButton.className = addon.tab.scratchClass('menu-bar_menu-bar-button', {\n        others: 'sa-analyze-button'\n      });\n\n      if (VSCodeLayout) {\n        // VSCodeLayout 下使用 SVG 图标\n        const img = document.createElement('img');\n        img.src = icon();\n        img.style.filter = \"grayscale(100%)\"\n        img.marginTop = '5px';\n        img.width = '20px';\n        img.height = '20px';\n        img.alt = '分析';\n        this.analyzeButton.appendChild(img);\n      } else {\n        // 普通布局下使用文字\n        this.analyzeButton.textContent = msg('analyze-button');\n      }\n      this.analyzeButton.title = msg('analyze-tooltip');\n\n      // 禁用时隐藏按钮\n      addon.tab.displayNoneWhileDisabled(this.analyzeButton);\n\n      this.analyzeButton.addEventListener('click', () => this.showAnalysisModal());\n\n      // 将按钮添加到目标位置\n      if (VSCodeLayout) {\n        // VSCodeLayout 下，按钮应该插入到标签栏（TabList）中\n        tabBar.appendChild(this.analyzeButton);\n      } else if (findBar) {\n        // 在 find-bar 右边添加\n        targetElement.insertBefore(this.analyzeButton, findBar.nextSibling);\n      } else {\n        // 在标签栏最右方添加\n        targetElement.appendChild(this.analyzeButton);\n      }\n    }\n\n    // 显示分析结果模态框\n    showAnalysisModal() {\n      // 如果模态框已存在，先移除\n      if (this.analyzeModal) {\n        this.analyzeModal.remove();\n      }\n\n      // 使用 addon.tab.createModal 创建模态框\n      const { backdrop, container, content, closeButton, remove } = addon.tab.createModal(msg('modal-title'), {\n        isOpen: true\n      });\n\n      this.analyzeModal = backdrop;\n      this.removeModal = remove;\n\n      // 添加自定义 CSS 类\n      container.classList.add('sa-analyze-modal-popup');\n      content.classList.add('sa-analyze-modal-content');\n\n      // 生成分析结果HTML（类似子目录中的界面）\n      const analysisHTML = this.generateAnalysisHTML();\n\n      // 设置模态框内容\n      content.innerHTML = `\n        <div class=\"sa-analyze-loading\" id=\"saAnalyzeLoading\">\n          <div class=\"sa-analyze-spinner\"></div>\n          <p>${msg('analyzing')}</p>\n        </div>\n        <div class=\"sa-analyze-results\" id=\"saAnalyzeResults\" style=\"display: none;\">\n          ${analysisHTML}\n        </div>\n      `;\n\n      // 添加关闭事件监听器\n      backdrop.addEventListener('click', () => this.closeModal());\n      closeButton.addEventListener('click', () => this.closeModal());\n\n      // 异步分析项目\n      this.analyzeProject();\n    }\n\n    closeModal() {\n      if (this.removeModal) {\n        this.removeModal();\n        this.analyzeModal = null;\n        this.removeModal = null;\n        \n        // 销毁图表实例\n        if (this.chartInstance) {\n          this.chartInstance.destroy();\n          this.chartInstance = null;\n        }\n        if (this.mathLogicChartInstance) {\n          this.mathLogicChartInstance.destroy();\n          this.mathLogicChartInstance = null;\n        }\n        if (this.drScratchChartInstance) {\n          this.drScratchChartInstance.destroy();\n          this.drScratchChartInstance = null;\n        }\n      }\n    }\n\n    // 分析项目\n    async analyzeProject() {\n      try {\n        // 使用 vm.toJSON 获取项目数据\n        const vm = addon.tab.traps.vm;\n        const projectJSON = JSON.parse(vm.toJSON());\n        \n        // 执行分析\n        const analysis = this.performAnalysis(projectJSON);\n\n        // 更新UI\n        this.updateAnalysisResults(analysis);\n      } catch (error) {\n        console.error(msg('analysis-error', '分析项目时出错:'), error);\n        document.getElementById('saAnalyzeLoading').innerHTML = `\n          <p style=\"color: #d32f2f;\">${msg('analysis-error')}</p>\n        `;\n      }\n    }\n\n    // 执行分析\n    performAnalysis(projectData) {\n      const analysis = {\n        totalBlocks: 0,\n        codeTypes: {},\n        extensions: [],\n        sprites: 0,\n        stageInfo: {},\n        editorPlatform: 'Scratch',\n        effectiveBlocks: 0,\n        functionDefinitions: 0,\n        projectSize: 0,\n        costumesSize: 0,\n        soundsSize: 0,\n        costumeCount: 0,\n        soundCount: 0,\n        variableCount: 0,\n        listCount: 0\n      };\n\n      // 分析扩展\n      this.analyzeExtensions(analysis, projectData);\n      \n      // 创建扩展名称映射\n      const extensionNameMap = {};\n      analysis.extensions.forEach(ext => {\n        extensionNameMap[ext.id] = ext.name;\n      });\n      \n      // 分析代码块\n      this.analyzeBlocks(analysis, projectData, extensionNameMap);\n      \n      // 分析精灵和舞台\n      this.analyzeSprites(analysis, projectData);\n      \n      // 分析有效积木和函数定义\n      this.analyzeEffectiveBlocks(analysis, projectData);\n      \n      return analysis;\n    }\n\n    // 分析代码块\n    analyzeBlocks(analysis, projectData, extensionNameMap = {}) {\n      const targets = projectData.targets || [];\n      \n      targets.forEach(target => {\n        const blocks = target.blocks || {};\n        \n        Object.values(blocks).forEach(block => {\n          if (block.opcode) {\n            analysis.totalBlocks++;\n            \n            const category = this.getBlockCategory(block.opcode, extensionNameMap);\n            analysis.codeTypes[category] = (analysis.codeTypes[category] || 0) + 1;\n          }\n        });\n      });\n    }\n\n    // 获取积木类型\n    getBlockCategory(opcode, extensionNameMap = {}) {\n      if (opcode.startsWith('motion_')) return msg('motion', '运动');\n      if (opcode.startsWith('looks_')) return msg('looks', '外观');\n      if (opcode.startsWith('sound_')) return msg('sound', '声音');\n      if (opcode.startsWith('event_')) return msg('events', '事件');\n      if (opcode.startsWith('control_')) return msg('control', '控制');\n      if (opcode.startsWith('sensing_')) return msg('sensing', '侦测');\n      if (opcode.startsWith('operator_')) return msg('operators', '运算');\n      if (opcode.startsWith('data_')) return msg('data', '数据');\n      if (opcode.startsWith('video_')) return msg('video', '视频');\n      \n      // 自定义函数和参数\n      if (opcode.startsWith('procedures_')) return msg('custom-functions', '自定义函数');\n      if (opcode.startsWith('argument_')) return msg('custom-functions', '自定义函数');\n      \n      // 扩展积木处理\n      if (!this.isStandardBlock(opcode)) {\n        const extensionId = this.getExtensionIdFromOpcode(opcode);\n        // 优先使用解析的中文名称\n        if (extensionNameMap[extensionId]) {\n          return extensionNameMap[extensionId];\n        }\n        // 回退到默认名称\n        return this.getExtensionNameFromId(extensionId);\n      }\n      \n      return msg('other', '其他');\n    }\n\n    // 检查是否为标准积木\n    isStandardBlock(opcode) {\n      const standardCategories = [\n        'motion_', 'looks_', 'sound_', 'event_', 'control_', \n        'sensing_', 'operator_', 'data_', 'video_',\n        'procedures_', 'argument_'\n      ];\n      \n      return standardCategories.some(category => opcode.startsWith(category));\n    }\n\n    // 从积木操作码提取扩展ID\n    getExtensionIdFromOpcode(opcode) {\n      const underscoreIndex = opcode.indexOf('_');\n      if (underscoreIndex > 0) {\n        return opcode.substring(0, underscoreIndex);\n      }\n      return opcode;\n    }\n\n    // 从扩展ID获取扩展名称\n    getExtensionNameFromId(extensionId) {\n      const defaultExtensionNames = {\n        'music': 'Music',\n        'pen': 'Pen',\n        'videoSensing': 'Video Sensing',\n        'text2speech': 'Text to Speech',\n        'translate': 'Translate',\n        'makeymakey': 'Makey Makey',\n        'microbit': 'micro:bit',\n        'ev3': 'LEGO EV3',\n        'wedo2': 'LEGO WeDo 2.0',\n        'boost': 'LEGO BOOST'\n      };\n      \n      return defaultExtensionNames[extensionId] || extensionId;\n    }\n\n    // 分析扩展\n    analyzeExtensions(analysis, projectData) {\n      const extensions = projectData.extensions || [];\n      const extensionURLs = projectData.extensionURLs || {};\n      \n      // 获取所有扩展积木操作码\n      const extensionBlocks = this.getExtensionBlocks(projectData);\n      \n      // 分析扩展信息\n      extensions.forEach(ext => {\n        let extensionName = this.getExtensionNameFromId(ext);\n        let extensionColor = null;\n        \n        const extensionInfo = {\n          id: ext,\n          name: extensionName,\n          color: extensionColor,\n          url: extensionURLs[ext] || null,\n          blocks: extensionBlocks.filter(block => block.extensionId === ext)\n        };\n        \n        analysis.extensions.push(extensionInfo);\n      });\n      \n      // 检查画笔扩展使用情况\n      const penBlocks = extensionBlocks.filter(block => block.extensionId === 'pen');\n      if (penBlocks.length > 0 && !extensions.includes('pen')) {\n        const penExtensionInfo = {\n          id: 'pen',\n          name: msg('extension-pen', '画笔'),\n          color: null,\n          url: null,\n          blocks: penBlocks\n        };\n        analysis.extensions.push(penExtensionInfo);\n      }\n    }\n\n    // 获取扩展积木\n    getExtensionBlocks(projectData) {\n      const extensionBlocks = [];\n      const targets = projectData.targets || [];\n      \n      targets.forEach(target => {\n        const blocks = target.blocks || {};\n        Object.values(blocks).forEach(block => {\n          if (block.opcode && !this.isStandardBlock(block.opcode)) {\n            const extensionId = this.getExtensionIdFromOpcode(block.opcode);\n            extensionBlocks.push({\n              opcode: block.opcode,\n              extensionId: extensionId\n            });\n          }\n        });\n      });\n      \n      return extensionBlocks;\n    }\n\n    // 分析精灵和舞台\n    analyzeSprites(analysis, projectData) {\n      const targets = projectData.targets || [];\n      const sprites = targets.filter(t => !t.isStage);\n      const stage = targets.find(t => t.isStage);\n      \n      analysis.sprites = sprites.length;\n      \n      // 统计造型和声音\n      targets.forEach(target => {\n        if (target.costumes) {\n          analysis.costumeCount += target.costumes.length;\n        }\n        if (target.sounds) {\n          analysis.soundCount += target.sounds.length;\n        }\n        if (target.variables) {\n          analysis.variableCount += Object.keys(target.variables).length;\n        }\n        if (target.lists) {\n          analysis.listCount += Object.keys(target.lists).length;\n        }\n      });\n    }\n\n    // 分析有效积木和函数定义\n    analyzeEffectiveBlocks(analysis, projectData) {\n      const targets = projectData.targets || [];\n      \n      targets.forEach(target => {\n        const blocks = target.blocks || {};\n        Object.values(blocks).forEach(block => {\n          if (block.opcode) {\n            // 统计有效积木（非 shadow）\n            if (!block.shadow) {\n              analysis.effectiveBlocks++;\n            }\n            \n            // 统计函数定义\n            if (block.opcode === 'procedures_definition') {\n              analysis.functionDefinitions++;\n            }\n          }\n        });\n      });\n    }\n\n    // 计算Dr.Scratch评分\n    calculateDrScratchScores(projectData) {\n      const scores = {\n        [msg('abstraction', '抽象和问题分解')]: 0,\n        [msg('parallelism', '并行性')]: 0,\n        [msg('logic', '逻辑思维')]: 0,\n        [msg('synchronization', '同步')]: 0,\n        [msg('flow-control', '流程控制')]: 0,\n        [msg('user-interactivity', '用户交互')]: 0,\n        [msg('data-representation', '数据表示')]: 0\n      };\n\n      const targets = projectData.targets || [];\n      const blockTypes = new Set(); // 存储所有使用的积木块种类\n      const eventBlockTypes = new Set(); // 存储事件积木块种类\n      const controlBlockTypes = new Set(); // 存储控制积木块种类\n      const operatorBlockTypes = new Set(); // 存储运算积木块种类\n      const dataBlockTypes = new Set(); // 存储数据积木块种类\n      const sensingBlockTypes = new Set(); // 存储侦测积木块种类\n      const motionBlockTypes = new Set(); // 存储运动积木块种类\n      const looksBlockTypes = new Set(); // 存储外观积木块种类\n      const soundBlockTypes = new Set(); // 存储声音积木块种类\n      const procedureBlockTypes = new Set(); // 存储自定义积木块种类\n      const variableNames = new Set();\n      const listNames = new Set();\n\n      // 收集所有积木块种类\n      targets.forEach(target => {\n        const blocks = target.blocks || {};\n        Object.values(blocks).forEach(block => {\n          if (block.opcode) {\n            blockTypes.add(block.opcode);\n            \n            // 分类收集积木块种类\n            if (block.opcode.startsWith('event_')) {\n              eventBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('control_')) {\n              controlBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('operator_')) {\n              operatorBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('data_')) {\n              dataBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('sensing_')) {\n              sensingBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('motion_')) {\n              motionBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('looks_')) {\n              looksBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('sound_')) {\n              soundBlockTypes.add(block.opcode);\n            }\n            if (block.opcode.startsWith('procedures_')) {\n              procedureBlockTypes.add(block.opcode);\n            }\n          }\n        });\n\n        // 收集变量和列表名称\n        if (target.variables) {\n          Object.values(target.variables).forEach(variable => {\n            if (Array.isArray(variable) && variable.length > 0) {\n              variableNames.add(variable[0]);\n            }\n          });\n        }\n        if (target.lists) {\n          Object.values(target.lists).forEach(list => {\n            if (Array.isArray(list) && list.length > 0) {\n              listNames.add(list[0]);\n            }\n          });\n        }\n      });\n\n      // 1. 抽象和问题分解 (Abstraction and problem decomposition)\n      // 完全基于积木块种类评分\n      const spriteCount = targets.filter(t => !t.isStage).length;\n      const hasMultipleSprites = spriteCount > 1;\n      const hasMultipleScripts = eventBlockTypes.size > 1; // 多种事件积木表示多个脚本\n      const hasCustomBlocks = procedureBlockTypes.has('procedures_definition');\n      const hasClones = controlBlockTypes.has('control_create_clone_of') || controlBlockTypes.has('control_start_as_clone');\n      \n      if (hasMultipleSprites && hasMultipleScripts) {\n        scores[msg('abstraction', '抽象和问题分解')] = 1; // Basic\n      }\n      if (hasCustomBlocks) {\n        scores[msg('abstraction', '抽象和问题分解')] = 2; // Developing\n      }\n      if (hasClones) {\n        scores[msg('abstraction', '抽象和问题分解')] = 3; // Proficiency\n      }\n\n      // 2. 并行性 (Parallelism)\n      // 基于不同的事件积木块种类\n      const hasGreenFlag = eventBlockTypes.has('event_whenflagclicked');\n      const hasKeyEvents = eventBlockTypes.has('event_whenkeypressed');\n      const hasClickEvents = eventBlockTypes.has('event_whenthisspriteclicked');\n      const hasMessageEvents = eventBlockTypes.has('event_whenbroadcastreceived');\n      const hasCloneEvents = controlBlockTypes.has('control_create_clone_of');\n      const hasSensorEvents = eventBlockTypes.has('event_whengreaterthan');\n      const hasBackdropEvents = eventBlockTypes.has('event_whenbackdropswitchesto');\n      \n      if (hasGreenFlag && eventBlockTypes.size > 1) {\n        scores[msg('parallelism', '并行性')] = 1; // Basic - 多个绿旗脚本\n      }\n      if ((hasKeyEvents || hasClickEvents) && (eventBlockTypes.size > 2)) {\n        scores[msg('parallelism', '并行性')] = 2; // Developing - 按键或点击事件\n      }\n      if (hasMessageEvents || hasCloneEvents || hasSensorEvents || hasBackdropEvents) {\n        scores[msg('parallelism', '并行性')] = 3; // Proficiency - 消息、克隆或传感器事件\n      }\n\n      // 3. 逻辑思维 (Logical thinking)\n      // 基于不同的逻辑积木块种类\n      const hasIf = controlBlockTypes.has('control_if');\n      const hasIfElse = controlBlockTypes.has('control_if_else');\n      const hasLogicOps = operatorBlockTypes.has('operator_and') || \n                         operatorBlockTypes.has('operator_or') || \n                         operatorBlockTypes.has('operator_not');\n      \n      if (hasIf) {\n        scores[msg('logic', '逻辑思维')] = 1; // Basic\n      }\n      if (hasIfElse) {\n        scores[msg('logic', '逻辑思维')] = 2; // Developing\n      }\n      if (hasLogicOps) {\n        scores[msg('logic', '逻辑思维')] = 3; // Proficiency\n      }\n\n      // 4. 同步 (Synchronization)\n      // 基于不同的同步积木块种类\n      const hasWait = controlBlockTypes.has('control_wait');\n      const hasBroadcast = eventBlockTypes.has('event_broadcast');\n      const hasReceiveMessage = eventBlockTypes.has('event_whenbroadcastreceived');\n      const hasStopAll = controlBlockTypes.has('control_stop_all');\n      const hasStopThis = controlBlockTypes.has('control_stop_this_script');\n      const hasStopOther = controlBlockTypes.has('control_stop_other_scripts_in_sprite');\n      const hasWaitUntil = controlBlockTypes.has('control_wait_until');\n      const hasBackdropChange = looksBlockTypes.has('looks_nextbackdrop') || looksBlockTypes.has('looks_switchbackdropto');\n      const hasBroadcastAndWait = eventBlockTypes.has('event_broadcastandwait');\n      \n      if (hasWait) {\n        scores[msg('synchronization', '同步')] = 1; // Basic\n      }\n      if (hasBroadcast || hasReceiveMessage || hasStopAll || hasStopThis || hasStopOther) {\n        scores[msg('synchronization', '同步')] = 2; // Developing\n      }\n      if (hasWaitUntil || hasBackdropChange || hasBroadcastAndWait) {\n        scores[msg('synchronization', '同步')] = 3; // Proficiency\n      }\n\n      // 5. 流程控制 (Flow control)\n      // 基于不同的流程控制积木块种类\n      const hasSequence = blockTypes.size > 0; // 任何积木块都表示有序列\n      const hasRepeat = controlBlockTypes.has('control_repeat') || controlBlockTypes.has('control_forever');\n      const hasRepeatUntil = controlBlockTypes.has('control_repeat_until');\n      \n      if (hasSequence) {\n        scores[msg('flow-control', '流程控制')] = 1; // Basic\n      }\n      if (hasRepeat) {\n        scores[msg('flow-control', '流程控制')] = 2; // Developing\n      }\n      if (hasRepeatUntil) {\n        scores[msg('flow-control', '流程控制')] = 3; // Proficiency\n      }\n\n      // 6. 用户交互 (User Interactivity)\n      // 基于不同的交互积木块种类\n      const hasGreenFlagEvent = eventBlockTypes.has('event_whenflagclicked');\n      const hasKeyPressedEvent = eventBlockTypes.has('event_whenkeypressed');\n      const hasSpriteClickedEvent = eventBlockTypes.has('event_whenthisspriteclicked');\n      const hasAskWait = sensingBlockTypes.has('sensing_askandwait');\n      const hasMouseBlocks = sensingBlockTypes.has('sensing_mousedown') || \n                            sensingBlockTypes.has('sensing_mousex') || \n                            sensingBlockTypes.has('sensing_mousey');\n      const hasSensorGreater = eventBlockTypes.has('event_whengreaterthan');\n      const hasVideo = Array.from(blockTypes).some(type => type.startsWith('video_'));\n      const hasAudioInteraction = soundBlockTypes.has('sound_playuntildone') || \n                                 soundBlockTypes.has('sound_setvolumeto') ||\n                                 soundBlockTypes.has('sound_changevolumeby');\n      \n      if (hasGreenFlagEvent) {\n        scores[msg('user-interactivity', '用户交互')] = 1; // Basic\n      }\n      if (hasKeyPressedEvent || hasSpriteClickedEvent || hasAskWait || hasMouseBlocks) {\n        scores[msg('user-interactivity', '用户交互')] = 2; // Developing\n      }\n      if (hasSensorGreater || hasVideo || hasAudioInteraction) {\n        scores[msg('user-interactivity', '用户交互')] = 3; // Proficiency\n      }\n\n      // 7. 数据表示 (Data representation)\n      // 基于不同的数据积木块种类\n      const hasSpriteModifiers = motionBlockTypes.size > 0 || looksBlockTypes.size > 0 || soundBlockTypes.size > 0;\n      const hasVariableOperations = variableNames.size > 0 && dataBlockTypes.size > 0;\n      const hasListOperations = listNames.size > 0 && Array.from(dataBlockTypes).some(type => type.includes('list'));\n      \n      if (hasSpriteModifiers) {\n        scores[msg('data-representation', '数据表示')] = 1; // Basic\n      }\n      if (hasVariableOperations) {\n        scores[msg('data-representation', '数据表示')] = 2; // Developing\n      }\n      if (hasListOperations) {\n        scores[msg('data-representation', '数据表示')] = 3; // Proficiency\n      }\n\n      return scores;\n    }\n\n    // 计算数学逻辑评分\n    calculateMathLogicScores(projectData) {\n      const targets = projectData.targets || [];\n      \n      // 统计各类积木块数量\n      let operatorCount = 0;\n      let controlCount = 0;\n      let dataCount = 0;\n\n      targets.forEach(target => {\n        const blocks = target.blocks || {};\n        Object.values(blocks).forEach(block => {\n          if (!block.opcode) return;\n          \n          if (block.opcode.startsWith('operator_')) {\n            operatorCount++;\n          }\n          \n          if (block.opcode.startsWith('control_')) {\n            controlCount++;\n          }\n          \n          if (block.opcode.startsWith('data_')) {\n            dataCount++;\n          }\n        });\n      });\n\n      const scores = {\n        [msg('operation-complexity', 'Operation Complexity')]: operatorCount,\n        [msg('logic-depth', 'Logic Depth')]: controlCount,\n        [msg('data-magnitude', 'Data Magnitude')]: dataCount\n      };\n\n      return scores;\n    }\n\n    // 格式化文件大小\n    formatFileSize(bytes) {\n      if (bytes === 0) return '0 B';\n      \n      const k = 1024;\n      const sizes = ['B', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      \n      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    }\n\n    // 生成分析结果HTML\n    generateAnalysisHTML() {\n      return `\n        <div class=\"sa-analyze-modal-body\">\n          <!-- 项目统计部分 -->\n          <div class=\"sa-analyze-section\">\n            <h3 class=\"sa-analyze-section-title\">${msg('project-stats', '项目统计')}</h3>\n            <div class=\"sa-analyze-stats-grid\" id=\"saStatsGrid\">\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('total-blocks', '总代码块数')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('effective-blocks', '有效积木')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('function-definitions', '函数定义')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('stat-sprites', '精灵数量')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('stat-costumes', '造型数量')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('stat-sounds', '声音数量')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('stat-variables', '变量数量')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('stat-lists', '列表数量')}</div>\n              </div>\n              <div class=\"sa-analyze-stat\">\n                <div class=\"sa-analyze-stat-value\">-</div>\n                <div class=\"sa-analyze-stat-label\">${msg('extensions', '扩展数量')}</div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 代码类型分布 -->\n          <div class=\"sa-analyze-section\">\n            <h3 class=\"sa-analyze-section-title\">${msg('block-distribution', '代码类型分布')}</h3>\n            <div class=\"sa-analyze-chart-container\">\n              <canvas id=\"saCodeTypeChart\" width=\"400\" height=\"200\"></canvas>\n            </div>\n          </div>\n\n          <!-- Dr.Scratch评分系统 -->\n          <div class=\"sa-analyze-section\">\n            <h3 class=\"sa-analyze-section-title\">${msg('dr-scratch-score', 'Dr.Scratch评分系统')}</h3>\n            <div class=\"sa-analyze-row\">\n              <div class=\"sa-analyze-col-6\">\n                <div class=\"sa-analyze-chart-container\">\n                  <canvas id=\"saDrScratchChart\" width=\"400\" height=\"300\"></canvas>\n                </div>\n              </div>\n              <div class=\"sa-analyze-col-6\">\n                <div class=\"sa-analyze-score-details\" id=\"saDrScratchDetails\">\n                  <div class=\"sa-analyze-score-summary\">\n                    <h4>${msg('total-score', '总分')}：<span id=\"saDrScratchTotalScore\">0</span> / 21</h4>\n                    <div class=\"sa-analyze-score-level\" id=\"saDrScratchScoreLevel\">${msg('evaluation-level', '评估等级')}：${msg('calculating', '计算中...')}</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 核心数学能力评估 -->\n          <div class=\"sa-analyze-section\">\n            <h3 class=\"sa-analyze-section-title\">${msg('math-logic-assessment', '核心数学能力评估')}</h3>\n            <div class=\"sa-analyze-row\">\n              <div class=\"sa-analyze-col-6\">\n                <div class=\"sa-analyze-chart-container\">\n                  <canvas id=\"saMathLogicChart\" width=\"400\" height=\"300\"></canvas>\n                </div>\n              </div>\n              <div class=\"sa-analyze-col-6\">\n                <div class=\"sa-analyze-score-details\" id=\"saMathLogicDetails\">\n                  <div class=\"sa-analyze-score-summary\">\n                    <h4>${msg('math-total-score', '数学总分')}：<span id=\"saMathTotalScore\">0</span> ${msg('blocks-count', '')}</h4>\n                    <div class=\"sa-analyze-score-level\" id=\"saMathScoreLevel\">${msg('evaluation-level', '评估等级')}：${msg('calculating', '计算中...')}</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- 使用的扩展 -->\n          <div class=\"sa-analyze-section\">\n            <h3 class=\"sa-analyze-section-title\">${msg('extensions-used', '使用的扩展')}</h3>\n            <div class=\"sa-analyze-extension-list\" id=\"saExtensionList\">\n              <p>${msg('loading', '加载中...')}</p>\n            </div>\n          </div>\n        </div>\n      `;\n    }\n\n    // 更新分析结果\n    updateAnalysisResults(analysis) {\n      // 更新统计数据\n      this.updateStats(analysis);\n      \n      // 更新代码类型分布图\n      this.displayCodeTypeChart(analysis);\n      \n      // 计算并更新Dr.Scratch评分\n      const vm = addon.tab.traps.vm;\n      const projectJSON = JSON.parse(vm.toJSON());\n      const drScratchScores = this.calculateDrScratchScores(projectJSON);\n      this.displayDrScratchScores(drScratchScores);\n      \n      // 计算并更新数学逻辑评分\n      const mathLogicScores = this.calculateMathLogicScores(projectJSON);\n      this.displayMathLogicScores(mathLogicScores);\n      \n      // 更新扩展列表\n      this.displayExtensions(analysis.extensions);\n\n      // 显示结果，隐藏加载\n      document.getElementById('saAnalyzeLoading').style.display = 'none';\n      document.getElementById('saAnalyzeResults').style.display = 'block';\n    }\n\n    // 更新统计数据\n    updateStats(analysis) {\n      const statsGrid = document.getElementById('saStatsGrid');\n      const totalExtensionBlocks = analysis.extensions.reduce((sum, ext) => sum + ext.blocks.length, 0);\n      \n      statsGrid.innerHTML = `\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.totalBlocks}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('total-blocks', '总代码块数')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.effectiveBlocks}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('effective-blocks', '有效积木')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.functionDefinitions}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('function-definitions', '函数定义')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.sprites}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('stat-sprites', '精灵数量')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.costumeCount}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('stat-costumes', '造型数量')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.soundCount}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('stat-sounds', '声音数量')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.variableCount}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('stat-variables', '变量数量')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.listCount}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('stat-lists', '列表数量')}</div>\n        </div>\n        <div class=\"sa-analyze-stat\">\n          <div class=\"sa-analyze-stat-value\">${analysis.extensions.length}</div>\n          <div class=\"sa-analyze-stat-label\">${msg('extensions', '扩展数量')}</div>\n        </div>\n      `;\n    }\n\n    // 显示代码类型分布图\n    displayCodeTypeChart(analysis) {\n      const canvas = document.getElementById('saCodeTypeChart');\n      if (!canvas) return;\n      \n      const ctx = canvas.getContext('2d');\n      \n      // 定义标准类别的固定顺序\n      const standardOrder = [\n        msg('motion', '运动'),\n        msg('looks', '外观'),\n        msg('sound', '声音'),\n        msg('events', '事件'),\n        msg('control', '控制'),\n        msg('sensing', '侦测'),\n        msg('operators', '运算'),\n        msg('data', '数据'),\n        msg('custom-functions', '自定义函数')\n      ];\n      \n      // 分离标准和扩展类别\n      const standardCategories = {};\n      const extensionCategories = {};\n      \n      Object.keys(analysis.codeTypes).forEach(category => {\n        if (standardOrder.includes(category)) {\n          standardCategories[category] = analysis.codeTypes[category];\n        } else {\n          extensionCategories[category] = analysis.codeTypes[category];\n        }\n      });\n      \n      // 按固定顺序排列标准类别\n      const orderedStandard = {};\n      standardOrder.forEach(category => {\n        if (standardCategories[category]) {\n          orderedStandard[category] = standardCategories[category];\n        }\n      });\n      \n      // 按字母顺序排序扩展类别\n      const sortedExtensions = {};\n      Object.keys(extensionCategories).sort().forEach(category => {\n        sortedExtensions[category] = extensionCategories[category];\n      });\n      \n      // 合并排序后的数据\n      const sortedCodeTypes = { ...orderedStandard, ...sortedExtensions };\n      const sortedLabels = Object.keys(sortedCodeTypes);\n      const sortedData = Object.values(sortedCodeTypes);\n      \n      // 定义每个类别的颜色\n      const categoryColors = {\n        [msg('motion', '运动')]: '#4C97FF',\n        [msg('looks', '外观')]: '#9966FF',\n        [msg('sound', '声音')]: '#CF63CF',\n        [msg('events', '事件')]: '#FFBF00',\n        [msg('control', '控制')]: '#FFAB19',\n        [msg('sensing', '侦测')]: '#5CB1D6',\n        [msg('operators', '运算')]: '#59C059',\n        [msg('data', '数据')]: '#FF8C1A',\n        [msg('custom-functions', '自定义函数')]: '#FF6680'\n      };\n      \n      // 为扩展生成默认颜色\n      const extensionColors = [\n        '#3498DB', '#E74C3C', '#F39C12', '#27AE60', '#16A085', \n        '#2ECC71', '#E67E22', '#95A5A6', '#34495E', '#7F8C8D', \n        '#9B59B6', '#1ABC9C', '#2C3E50', '#F1C40F', '#D35400', \n        '#C0392B', '#BDC3C7', '#7F8C8D', '#95A5A6'\n      ];\n      \n      // 为每个标签分配对应颜色\n      const assignedColors = sortedLabels.map((label, index) => {\n        if (categoryColors[label]) {\n          return categoryColors[label];\n        } else {\n          // 检查是否是具有自定义颜色的扩展\n          const extension = analysis.extensions.find(ext => ext.name === label);\n          if (extension && extension.color) {\n            return extension.color;\n          }\n          // 使用预定义的扩展颜色\n          return extensionColors[index % extensionColors.length];\n        }\n      });\n      \n      // 销毁现有图表\n      if (this.chartInstance) {\n        this.chartInstance.destroy();\n        this.chartInstance = null;\n      }\n      \n      // 创建新图表\n      this.chartInstance = new Chart(ctx, {\n        type: 'doughnut',\n        data: {\n          labels: sortedLabels,\n          datasets: [{\n            data: sortedData,\n            backgroundColor: assignedColors,\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              position: 'right',\n              labels: {\n                boxWidth: 12,\n                padding: 10,\n                font: {\n                  size: 11\n                }\n              }\n            },\n            tooltip: {\n              callbacks: {\n                label: function(context) {\n                  const label = context.label || '';\n                  const value = context.raw || 0;\n                  const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                  const percentage = ((value / total) * 100).toFixed(1);\n                  return `${label}: ${value} (${percentage}%)`;\n                }\n              }\n            }\n          }\n        }\n      });\n    }\n\n    // 显示Dr.Scratch评分\n    displayDrScratchScores(scores) {\n      const canvas = document.getElementById('saDrScratchChart');\n      if (!canvas) return;\n      \n      const ctx = canvas.getContext('2d');\n      \n      const labels = Object.keys(scores);\n      const data = Object.values(scores);\n      const totalScore = data.reduce((sum, val) => sum + val, 0);\n      \n      // 更新总分\n      document.getElementById('saDrScratchTotalScore').textContent = totalScore;\n      \n      // 计算等级\n      let level = msg('beginner', '初学者');\n      if (totalScore >= 18) {\n        level = msg('expert', '专家级');\n      } else if (totalScore >= 14) {\n        level = msg('advanced', '高级');\n      } else if (totalScore >= 10) {\n        level = msg('intermediate', '中级');\n      } else if (totalScore >= 6) {\n        level = msg('developing', '发展中');\n      }\n      document.getElementById('saDrScratchScoreLevel').textContent = `${msg('evaluation-level', '评估等级')}：${level}`;\n      \n      // 更新评分详情\n      const detailsHTML = labels.map(label => `\n        <div class=\"sa-analyze-score-item\">\n          <div class=\"sa-analyze-score-label\">${label}</div>\n          <div class=\"sa-analyze-score-bar\">\n            <div class=\"sa-analyze-score-fill\" style=\"width: ${(scores[label] / 3) * 100}%\"></div>\n          </div>\n          <div class=\"sa-analyze-score-value\">${scores[label]}/3</div>\n        </div>\n      `).join('');\n      \n      const detailsContainer = document.getElementById('saDrScratchDetails');\n      const summaryHTML = detailsContainer.querySelector('.sa-analyze-score-summary').outerHTML;\n      detailsContainer.innerHTML = summaryHTML + detailsHTML;\n      \n      // 销毁现有图表\n      if (this.drScratchChartInstance) {\n        this.drScratchChartInstance.destroy();\n        this.drScratchChartInstance = null;\n      }\n      \n      // 创建雷达图\n      this.drScratchChartInstance = new Chart(ctx, {\n        type: 'radar',\n        data: {\n          labels: labels,\n          datasets: [{\n            label: msg('computational-thinking-score', '计算思维评分'),\n            data: data,\n            backgroundColor: 'rgba(77, 151, 255, 0.2)',\n            borderColor: '#4d97ff',\n            borderWidth: 2,\n            pointBackgroundColor: '#4d97ff',\n            pointBorderColor: '#fff',\n            pointHoverBackgroundColor: '#fff',\n            pointHoverBorderColor: '#4d97ff'\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            r: {\n              beginAtZero: true,\n              max: 3,\n              ticks: {\n                stepSize: 1\n              }\n            }\n          },\n          plugins: {\n            legend: {\n              display: false\n            }\n          }\n        }\n      });\n    }\n\n    // 显示数学逻辑评分\n    displayMathLogicScores(scores) {\n      const canvas = document.getElementById('saMathLogicChart');\n      if (!canvas) return;\n      \n      const ctx = canvas.getContext('2d');\n      \n      const labels = Object.keys(scores);\n      const data = Object.values(scores);\n      const totalScore = data.reduce((sum, val) => sum + val, 0);\n      \n      // 更新总分\n      document.getElementById('saMathTotalScore').textContent = totalScore;\n      \n      // 计算等级\n      let level = msg('beginner', '初级');\n      if (totalScore >= 20) {\n        level = msg('advanced', '高级');\n      } else if (totalScore >= 10) {\n        level = msg('intermediate', '中级');\n      } else if (totalScore >= 5) {\n        level = msg('developing', '发展中');\n      }\n      document.getElementById('saMathScoreLevel').textContent = `${msg('evaluation-level', '评估等级')}：${level}`;\n      \n      // 更新评分详情\n      const detailsHTML = labels.map(label => `\n        <div class=\"sa-analyze-score-item\">\n          <div class=\"sa-analyze-score-label\">${label}</div>\n          <div class=\"sa-analyze-score-value\">${scores[label]} </div>\n        </div>\n      `).join('');\n      \n      const detailsContainer = document.getElementById('saMathLogicDetails');\n      const summaryHTML = detailsContainer.querySelector('.sa-analyze-score-summary').outerHTML;\n      detailsContainer.innerHTML = summaryHTML + detailsHTML;\n      \n      // 销毁现有图表\n      if (this.mathLogicChartInstance) {\n        this.mathLogicChartInstance.destroy();\n        this.mathLogicChartInstance = null;\n      }\n      \n      // 数据标准化\n      const maxValue = Math.max(...data, 1);\n      const normalizedData = data.map(value => value / maxValue);\n      \n      // 创建雷达图\n      this.mathLogicChartInstance = new Chart(ctx, {\n        type: 'radar',\n        data: {\n          labels: labels,\n          datasets: [{\n            label: msg('relative-intensity', '相对强度'),\n            data: normalizedData,\n            backgroundColor: 'rgba(230, 81, 0, 0.2)',\n            borderColor: '#E65100',\n            borderWidth: 2,\n            pointBackgroundColor: '#E65100',\n            pointBorderColor: '#fff',\n            pointHoverBackgroundColor: '#fff',\n            pointHoverBorderColor: '#E65100'\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            r: {\n              beginAtZero: true,\n              max: 1,\n              ticks: {\n                stepSize: 0.2\n              }\n            }\n          },\n          plugins: {\n            legend: {\n              display: false\n            },\n            tooltip: {\n              callbacks: {\n                label: function(context) {\n                  const label = context.label || '';\n                  const rawValue = data[context.dataIndex];\n                  return `${label}: ${rawValue} `;\n                }\n              }\n            }\n          }\n        }\n      });\n    }\n\n    // 显示扩展列表\n    displayExtensions(extensions) {\n      const extensionList = document.getElementById('saExtensionList');\n      \n      if (extensions.length === 0) {\n        extensionList.innerHTML = `<p>${msg('no-extensions', '未使用扩展')}</p>`;\n        return;\n      }\n      \n      let html = '<div class=\"sa-analyze-extensions-grid\">';\n      \n      extensions.forEach(extension => {\n        const color = extension.color || '#888888';\n        html += `\n          <div class=\"sa-analyze-extension-item\">\n            <div class=\"sa-analyze-extension-color\" style=\"background-color: ${color}\"></div>\n            <div class=\"sa-analyze-extension-name\">${extension.name}</div>\n            <div class=\"sa-analyze-extension-count\">${extension.blocks.length} ${msg('blocks-count', '')}</div>\n          </div>\n        `;\n      });\n      \n      html += '</div>';\n      extensionList.innerHTML = html;\n    }\n\n    // 初始化插件\n    async init() {\n      await this.createAnalyzeButton();\n    }\n  }\n\n  // 创建并初始化分析器\n  const analyzer = new SimpleProjectAnalyzer();\n\n  // 等待编辑器加载完成\n  addon.tab.waitForElement('[class*=\"menu-bar_menu-bar\"], [class*=\"react-tabs_react-tabs__tab-list\"]', {\n    markAsSeen: true\n  }).then(() => {\n    analyzer.init();\n  });\n}","\n    const original = \"<svg version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" width=\\\"146.176\\\" height=\\\"146.176\\\" viewBox=\\\"0,0,146.176,146.176\\\"><g transform=\\\"translate(-166.912,-106.912)\\\"><g fill=\\\"#855cd6\\\" stroke=\\\"#855cd6\\\" stroke-width=\\\"0\\\" stroke-miterlimit=\\\"10\\\"><g><path d=\\\"M191.69035,155.17408l48.26208,-48.26208l23.48373,23.48373l-48.26208,48.26208z\\\"/><path d=\\\"M191.69035,155.17408l23.48373,-23.48373l73.04042,73.04042l-23.48373,23.48373z\\\"/><path d=\\\"M166.912,179.95243l23.48373,-23.48373l48.30965,48.30965l-23.48373,23.48373z\\\"/><path d=\\\"M241.29462,155.22166l23.48373,-23.48373l23.48373,23.48373l-23.48373,23.48373z\\\"/><path d=\\\"M266.12054,180.04758l23.48373,-23.48373l23.48373,23.48373l-23.48373,23.48373z\\\"/><path d=\\\"M216.56385,229.60427l48.26208,-48.26208l23.48373,23.48373l-48.26208,48.26208z\\\"/></g></g></g></svg><!--rotationCenter:73.0879994012752:73.08799940127517-->\";\n\n    const getSRC = () => {\n        const recolored = typeof Recolor === 'object' ? (\n            original.replace(/#855cd6/gi, Recolor.primary)\n        ) : original;\n        return 'data:image/svg+xml;,' + encodeURIComponent(recolored);\n    };\n\n    export default getSRC;\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAsGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAsCA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvrCA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}